<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>OpenVX ICD Extension: The OpenVX Installable Client Driver Loader Extension</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="OpenVX_Color_119x55.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenVX ICD Extension
   &#160;<span id="projectnumber">76df2d2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The OpenVX Installable Client Driver Loader Extension </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_overview"></a>
Overview</h1>
<p>The vx_khr_icd extension defines a simple mechanism through which the Khronos installable client driver loader (ICD Loader) may expose multiple separate vendor installable client drivers (Vendor ICDs) for OpenVX. An application written against the ICD Loader will be able to access all vx_platform exposed by all vendor implementations with the ICD Loader acting as a demultiplexer.</p>
<h1><a class="anchor" id="sec_Dependencies"></a>
Dependencies</h1>
<p>OpenVX 1.0.1 or later</p>
<h1><a class="anchor" id="sec_external"></a>
External Interface</h1>
<p>The ICD Loader interface can be accessed by application using:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;VX/vx_khr_icd.h&gt;</span></div>
</div><!-- fragment --><p>The <a class="el" href="d2/d66/vx__khr__icd_8h_source.html">VX/vx_khr_icd.h</a> includes definition of a new object <a class="el" href="db/d9d/group__group__icd.html#ga7f3c3c6582c6987e4a15087aaf0735cd">vx_platform</a> and new functions <a class="el" href="db/d9d/group__group__icd.html#gafe2e3d9b07a3643127533734eb8b37cf">vxIcdGetPlatforms</a>, <a class="el" href="db/d9d/group__group__icd.html#gaeaeb91c57887d277b8110c3a2f1f75a9">vxQueryPlatform</a>, <a class="el" href="db/d9d/group__group__icd.html#ga42a27b597b972a94b20336e0f90e241e">vxCreateContextFromPlatform</a>. An ICD compatible vendor implementation is required to implement the function <a class="el" href="db/d9d/group__group__icd.html#ga42a27b597b972a94b20336e0f90e241e">vxCreateContextFromPlatform</a>. And the implementation of <a class="el" href="db/d9d/group__group__icd.html#gafe2e3d9b07a3643127533734eb8b37cf">vxIcdGetPlatforms</a>, <a class="el" href="db/d9d/group__group__icd.html#gaeaeb91c57887d277b8110c3a2f1f75a9">vxQueryPlatform</a>, and struct _vx_platform will be part of ICD Loader source. See <code><a class="el" href="db/d9d/group__group__icd.html">OpenVX ICD Loader API</a></code> for further details.</p>
<h1><a class="anchor" id="sec_Inferring"></a>
Inferring Vendor ICD Calls from Arguments</h1>
<p>At every OpenVX function call, the ICD Loader infers the Vendor ICD function to call from the ICD compatible object that is passed as the first argument. All OpenVX objects are said to be ICD compatible if the struct _vx_reference contains a placeholder for vx_platform as it’s first field, as shown below:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>_vx_reference {</div>
<div class="line">       <span class="keyword">struct </span>_vx_platform * platform;</div>
<div class="line">       <span class="comment">// ... remainder of internal data</span></div>
<div class="line">   };</div>
</div><!-- fragment --><p>The structure _vx_platform has a function pointer dispatch table which is used to make direct calls to a particular vendor implementation. All objects created from ICD compatible objects must be ICD compatible.</p>
<p>Functions which do not take ICD compatible object or a pointer to ICD compatible object as it’s first argument needs to be implemented by ICD Loader. The OpenVX functions that are required for an implementation in ICD Loader source are:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> * VX_API_CALL vxFormatImagePatchAddress1d(<span class="keywordtype">void</span> *ptr, vx_uint32 index, <span class="keyword">const</span> vx_imagepatch_addressing_t *addr);</div>
<div class="line"><span class="keywordtype">void</span> * VX_API_CALL vxFormatImagePatchAddress2d(<span class="keywordtype">void</span> *ptr, vx_uint32 index, <span class="keyword">const</span> vx_imagepatch_addressing_t *addr);</div>
<div class="line">vx_context VX_API_CALL vxCreateContext();</div>
</div><!-- fragment --><p>The ICD Loader’s vxCreateContext implementation is required to pick the default platform and to call the vendor specific implementation of vxCreateContextFromPlatform.</p>
<p>The ICD Loader’s vxHint implementation is required to check the OpenVX version of the vendor implementation and handle function signature changes between OpenVX 1.0.1 and OpenVX 1.1.</p>
<h1><a class="anchor" id="sec_Linux"></a>
Vendor Enumerations on Linux</h1>
<p>To enumerate vendor ICDs on Linux, the ICD Loader scans the files under /etc/OpenVX/vendors. For each file in this path, the ICD Loader opens the file as a text file. The expected format for the file is a single line of text which specifies the Vendor ICD’s library. If the Vendor ICD comes with a separate library for immediate mode functions (VXU), the expected format for the file is a single line of text with OpenVX and VXU libraries separated by semi-colon(;) in that order.</p>
<p>The ICD Loader will attempt to open that file as a shared object using dlopen(). Note that the library specified may be an absolute path or just a file name. <br/>
<b> EXAMPLE </b> </p>
<div class="fragment"><div class="line">If the following file exists</div>
<div class="line">    /etc/OpenVX/vendors/VendorA.icd</div>
<div class="line">and contains the text</div>
<div class="line">    libopenvx.so;libvxu.so</div>
<div class="line">then the ICD Loader will load the libraries <span class="stringliteral">&quot;libopenvx.so&quot;</span> and <span class="stringliteral">&quot;libvxu.so&quot;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="sec_Android"></a>
Vendor Enumerations on Android</h1>
<p>To enumerate vendor ICDs on Android, the ICD Loader scans the files under /system/vendor/Khronos/OpenVX/vendors/. For each file in this path, the ICD Loader opens the file as a text file. The expected format for the file is a single line of text which specifies the Vendor ICD’s library. If the Vendor ICD comes with a separate library for immediate mode functions (VXU), the expected format for the file is a single line of text with OpenVX and VXU libraries separated by semi-colon(;) in that order.</p>
<p>The ICD Loader will attempt to open that file as a shared object using dlopen(). Note that the library specified may be an absolute path or just a file name. <br/>
<b> EXAMPLE </b> </p>
<div class="fragment"><div class="line">If the following file exists</div>
<div class="line">    /system/vendor/Khronos/OpenVX/vendors/VendorA.icd</div>
<div class="line">and contains the text</div>
<div class="line">    libopenvx.so</div>
<div class="line">then the ICD Loader will load the library <span class="stringliteral">&quot;libopenvx.so&quot;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="sec_Windows"></a>
Vendor Enumerations on Windows</h1>
<p>To enumerate Vendor ICDs on Windows, the ICD Loader scans the values in the registry key HKEY_LOCAL_MACHINE. For each value in this key which has DWORD data set to 0, the ICD Loader opens the dynamic link library specified by the name of the value using LoadLibraryA. If the Vendor ICD comes with a separate library for immediate mode functions (VXU), the expected format for the name of the value is a single line of text with OpenVX and VXU libraries separated by semi-colon(;) in that order. <br/>
<b> EXAMPLE </b> </p>
<div class="fragment"><div class="line">If the registry contains the following value</div>
<div class="line">  [HKEY_LOCAL_MACHINE\SOFTWARE\Khronos\OpenVX\Vendors]</div>
<div class="line">  <span class="stringliteral">&quot;c:\\vendor_a\\openvx.dll;c:\\vendor_a\\vxu.dll&quot;</span>=dword:00000000</div>
<div class="line">then the ICD will open the libraries <span class="stringliteral">&quot;c:\vendor_a\openvx.dll&quot;</span> and <span class="stringliteral">&quot;c:\vendor_a\vxu.dll&quot;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="sec_sample_implementation"></a>
ICD Compatible Khronos Sample Implementation</h1>
<p>To make the sample implementation compatible with ICD implementation, the following two changes are required:</p>
<div class="fragment"><div class="line">1. Add <span class="stringliteral">&quot;struct _vx_platform * platform;&quot;</span> as first field to <span class="stringliteral">&quot;struct _vx_reference&quot;</span></div>
<div class="line">2. Every derived reference should copy <span class="stringliteral">&quot;platform&quot;</span> from it<span class="stringliteral">&#39;s parent:</span></div>
<div class="line"><span class="stringliteral">     add &quot;ref-&gt;platform = context ? context-&gt;base.platform : NULL;&quot; statement to vxInitReference()</span></div>
<div class="line"><span class="stringliteral">3. Create a new vxCreateContextFromPlatform() which initializes context-&gt;base.platform with</span></div>
<div class="line"><span class="stringliteral">   the function argument and performs same functionality as vxCreateContext().</span></div>
</div><!-- fragment --><h1><a class="anchor" id="sec_ICD_loader"></a>
Sample Implementation of ICD Loader</h1>
<p>An implementation of ICD Loader is available in vx_khr_icd folder of sample implementation tree. Use cmake to build ICD Loader library to a static library with the name “openvx”. Applications that use ICD Loader library can use any ICD compatible vendor implementation picked during run-time. <br/>
<b>Example: Build and Run Conformance Tests using ICD Loader</b> </p>
<div class="fragment"><div class="line"><span class="preprocessor"># Build ICD Loader sample implementation from vx_khr_icd folder</span></div>
<div class="line"><span class="preprocessor"></span>% pushd &lt;path-to-sample-implementation-trunk&gt;</div>
<div class="line">% export OPENVX_DIR=$PWD</div>
<div class="line">% popd</div>
<div class="line">% mkdir -p build/vx_khr_icd</div>
<div class="line">% cd build/vx_khr_icd</div>
<div class="line">% cmake $OPENVX_DIR/vx_khr_icd</div>
<div class="line">% make</div>
<div class="line">% export VX_KHR_ICD_LIB=$PWD</div>
<div class="line">% cd ../..</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Build OpenVX Conformance Tests using ICD Loader</span></div>
<div class="line"><span class="preprocessor"></span>% mkdir -p build/conformance_tests</div>
<div class="line">% cd build/conformance_tests</div>
<div class="line">% cmake -DOPENVX_INCLUDES=$OPENVX_DIR/include \</div>
<div class="line">        -DOPENVX_LIBRARIES=$VX_KHR_ICD_LIB/libopenvx.a\;pthread\;dl\;m \</div>
<div class="line">        $OPENVX_DIR/conformance_tests</div>
<div class="line">% make</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Run Conformance Tests</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># Note: use of sample implementation requires LD_LIBRARY_PATH to be set properly</span></div>
<div class="line"><span class="preprocessor"></span>% export VX_TEST_DATA_PATH=$OPENVX_DIR/conformance_tests/test_data</div>
<div class="line">% &lt;build binary path&gt;/vx_test_conformance</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_updates"></a>
Updates to ICD Loader source code</h1>
<p>The sample implementation tree has a python script vx_khr_icd/vx_khr_icd.py to update ICD Loader source code from OpenVX header files in include/VX folder. </p>
<div class="fragment"><div class="line"><span class="preprocessor"># To update vx_dispatch.h, vx_dispatch.c, and ../include/VX/vx_khr_icd.h files</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># with the API in VX/vx_api.h, VX/vx_nodes.h, VX/vxu.h, and VX/vx_compatibility.h,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor"># run below command from vx_khr_icd folder</span></div>
<div class="line"><span class="preprocessor"></span>% python vx_khr_icd.py \</div>
<div class="line">      ../include/VX/vx_api.h ../include/VX/vx_nodes.h \</div>
<div class="line">      ../include/VX/vxu.h \</div>
<div class="line">      ../include/VX/vx_compatibility.h</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># To create ICD Loader source code for OpenVX 1.0.1:</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   - unzip extract openvx_sample_1.0.1.tar.bz2 in openvx_sample folder</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   - copy vx_khr_icd folder into openvx_sample folder</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#   - run below command from openvx_sample/vx_khr_icd folder</span></div>
<div class="line"><span class="preprocessor"></span>% python vx_khr_icd.py</div>
<div class="line">      ../include/VX/vx_api.h ../include/VX/vx_nodes.h \</div>
<div class="line">      ../include/VX/vxu.h</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_Contributors"></a>
Contributors</h1>
<ul>
<li>Radhakrishna Giduthuri (<a href="#" onclick="location.href='mai'+'lto:'+'rad'+'ha'+'.gi'+'du'+'thu'+'ri'+'@am'+'d.'+'com'; return false;">radha<span style="display: none;">.nosp@m.</span>.gid<span style="display: none;">.nosp@m.</span>uthur<span style="display: none;">.nosp@m.</span>i@am<span style="display: none;">.nosp@m.</span>d.com</a>) </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
